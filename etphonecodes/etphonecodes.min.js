/*
ETPhoneCodes
version: 0.1.0
description: A javascript object for entering international telephone numbers
repository: https://github.com/EditionsTissot/ETPhoneCodes
license: GNU GENERAL PUBLIC LICENSE Version 2
author: Editions Tissot (http://www.editions-tissot.fr/)
*/

var ETPhoneCodes=function(e,t,o,n){if(this.IDNode="",this.startCountryCodeDefault="fr",this.preferredCountriesDefault=["fr","ch","be","mc","gy","gp","mq","re"],this.writeCallingCodeAtStartDefault=!0,this.placeholderDefault="e.g. +1 702 123 4567",t="undefined"!=typeof t?t:this.startCountryCodeDefault,o="undefined"!=typeof o?o:this.preferredCountriesDefault,n="undefined"!=typeof n?n:this.writeCallingCodeAtStartDefault,placeholder="undefined"!=typeof placeholder?placeholder:this.placeholderDefault,"undefined"==typeof e||""==e)return this.log('ETPhoneCodes - FATAL ERROR: Thank you to specify the "IDNode" (The name of attribute id from your <input>).',"error");this.IDNode=e;var a=document.getElementById(this.IDNode);if(null==a)return this.log('ETPhoneCodes - FATAL ERROR: The node of "IDNode" does not exist, thank you to specify a id of an existing <input>.',"error");"tel"!=a.getAttribute("type")&&"text"!=a.getAttribute("type")&&this.log('ETPhoneCodes - WARNING: The type of your <input> must be "tel" or "text".',"warning");for(var r=document.getElementsByClassName("ETPhoneCodes-hide"),d=0;d<r.length;d++)r[d].style.display="none";var s=document.createElement("div");s.className="etphonecodes-container",s.setAttribute("id","etphonecodes-container_"+this.IDNode),s.setAttribute("data-id",this.IDNode),this.wrapNode(a,s);var c=document.createElement("div");c.setAttribute("id","etphonecodes-flag-dropdown_"+this.IDNode),c.className="f16 etphonecodes-flag-dropdown";var i=document.createElement("div");i.setAttribute("id","etphonecodes-selected-flag_"+this.IDNode),i.className="etphonecodes-selected-flag";var l=document.createElement("div");l.className="flag "+t;var u=document.createElement("div");u.setAttribute("id","etphonecodes-callcode_"+this.IDNode),u.className="etphonecodes-callcode";var p=document.createElement("div");p.className="etphonecodes-down-arrow",i.appendChild(l),i.appendChild(u),i.appendChild(p),c.appendChild(i),s.insertBefore(c,a);var h=document.createElement("ul");h.setAttribute("id","etphonecodes-countries-list_"+this.IDNode),h.className="hide etphonecodes-countries-list";var m=document.createElement("input");m.setAttribute("id","etphonecodes-search-zone_"+this.IDNode),m.placeholder="Nom du pays",m.className="etphonecodes-search-zone",h.appendChild(m);var g=document.createElement("div");g.setAttribute("id","etphonecodes-suppr-search-zone_"+this.IDNode),g.className="etphonecodes-suppr-search-zone",g.innerHTML="X",h.appendChild(g);for(var d=0;d<o.length;d++){var y=this.getDataCountryToCA2(o[d]),f=this.createCountryLi(y,!0);h.appendChild(f)}var C=document.createElement("li");C.className="divider",h.appendChild(C);for(var d=0;d<ETPhoneCodesData.countries.length;d++){var f=this.createCountryLi(ETPhoneCodesData.countries[d],!1);h.appendChild(f)}c.appendChild(h);var v=document.createElement("input");v.setAttribute("id","etphonecodes-calling-code_"+this.IDNode),v.setAttribute("type","hidden"),v.setAttribute("name",e+"_calling-code-value"),s.insertBefore(v,a);var E=document.createElement("input");E.setAttribute("id","etphonecodes-phone-number_"+this.IDNode),E.setAttribute("type","hidden"),E.setAttribute("name",e+"_phone-number-value"),s.insertBefore(E,a);var b=document.createElement("input");b.setAttribute("id","etphonecodes-value_"+this.IDNode),b.setAttribute("type","hidden"),b.setAttribute("name",a.getAttribute("name")),a.setAttribute("name",e+"_display-value"),s.insertBefore(b,a);var T=document.getElementById("etphonecodes-callcode_"+this.IDNode),N="";b.value="+"+this.getDataCountryToCA2(t)["calling-code"],v.value="+"+this.getDataCountryToCA2(t)["calling-code"],this.changePlaceholderFromCA2(a,t),n&&(T.innerHTML="+"+this.getDataCountryToCA2(t)["calling-code"]),document.body.onclick=function(e){var t=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(e));ETPhoneCodes.prototype.showOrHideCountriesList(e,t)},h.onclick=function(e){var o=ETPhoneCodes.prototype.getEventTarget(e),n=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(e));"block"==h.style.display&&o.getAttribute("id")!="etphonecodes-countries-list_"+n&&"divider"!=o.className&&o.getAttribute("id")!="etphonecodes-suppr-search-zone_"+n&&"etphonecodes-search-zone"!=o.className&&(o.parentNode==h?ETPhoneCodes.prototype.manageClickCountry(a,o,t,T,n):ETPhoneCodes.prototype.manageClickCountry(a,o.parentNode,t,T,n),N=ETPhoneCodes.prototype.InputFormating(a,t,n))},a.onkeypress=function(e){},a.onkeydown=function(e){var o=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(e)),n=(a.value,document.getElementById("etphonecodes-container_"+o)),r=n.getElementsByClassName("country active")[0];return r="undefined"!=typeof r?r.getAttribute("data-country-code"):t,!0},a.onkeyup=function(e){var o=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(e));N.trim()!=a.value.trim()&&(N=ETPhoneCodes.prototype.InputFormating(a,t,o))},g.onclick=function(e){A.value="",A.onkeyup()};var A=document.getElementById("etphonecodes-search-zone_"+this.IDNode);A.onkeyup=function(e){var t=document.getElementById("etphonecodes-container_"+this.IDNode),o=A.value,n=t.getElementsByClassName("country");if(""!=o.trim())for(var a=0;a<n.length;a++)n[a].className=n[a].className.replace("hidden","").trim()+" hidden";else for(var a=0;a<n.length;a++)n[a].className=n[a].className.replace("hidden","").trim();var r=o.toUpperCase();r=new RegExp(r);for(var a=0;a<n.length;a++)r.test(n[a].getElementsByClassName("country-name")[0].innerHTML.toUpperCase())&&(new RegExp("preferred").test(n[a].className)||(n[a].className=n[a].className.replace("hidden","").trim()));return!0}};ETPhoneCodes.prototype.getDataID=function(e){return"BODY"!=e.tagName?null!=e.getAttribute("data-id")&&""!=e.getAttribute("data-id")?e.getAttribute("data-id"):ETPhoneCodes.prototype.getDataID(e.parentNode):""},ETPhoneCodes.prototype.log=function(e,t){switch(t=t||"black",bgc="White",t){case"success":t="Green",bgc="LimeGreen";break;case"info":t="DodgerBlue",bgc="Turquoise";break;case"error":t="Red",bgc="Black";break;case"start":t="OliveDrab",bgc="PaleGreen";break;case"warning":t="Tomato",bgc="Black";break;case"end":t="Orchid",bgc="MediumVioletRed";break;default:t=t}"object"==typeof e?console.log(e):"object"==typeof t?(console.log("%c"+e,"color: PowderBlue;font-weight:bold; background-color: RoyalBlue;"),console.log(t)):console.log("%c"+e,"color:"+t+";font-weight:bold; background-color: "+bgc+";")},ETPhoneCodes.prototype.InputFormating=function(e,t,o){var n=e.value,a=n,r=!1,d=document.getElementById("etphonecodes-container_"+o);n=n.replace(/\(0\)|^0/g,""),n=n.replace(/\(0/g,""),n=n.replace(/0\)/g,""),r=a==n?!1:!0;var s="",c=d.getElementsByClassName("country active")[0];c="undefined"!=typeof c?c.getAttribute("data-country-code"):t;var i=ETPhoneCodes.prototype.getDataCountryToCA2(c);n=n.replace(/[^0-9]/g,"");var l=10;"undefined"!=typeof i.numbers&&(l=i.numbers),n.length>l&&(n=n.substr(0,l));var s=ETPhoneCodes.prototype.getDataCountryToCA2(t)["calling-code"];if(""!=s&&""!=c){var u={Z:/[1-9]/,C:/[0-9]/},p=n.replace(/ /g,"").trim(),i=ETPhoneCodes.prototype.getDataCountryToCA2(c),h="";if("undefined"!=typeof i.format&&""!=p)for(var m=0,g=0;g<p.length;g++)character=p.substr(g,1),m<i.format.length?(format=i.format.substr(m,1),"."==format&&(h+=" ",m++,format=i.format.substr(m,1)),u[format].test(character)?h+=""+character:("0"!=character||"Z"!=format)&&(m=i.format.length,h+=""+character)):h+=""+character,m++;if("undefined"!=typeof i.format)h=""!=h?"(0)"+h:0==r||"(0)"==a||"(0"==a||"0)"==a?h:"(0)"+h,e.value=h,n=e.value;else{var y=e.value;y=y.replace(/[^0-9]/g,""),e.value=y}}return document.getElementById("etphonecodes-calling-code_"+o).value="+"+i["calling-code"],document.getElementById("etphonecodes-phone-number_"+o).value=e.value.replace(/ /g,"").trim(),document.getElementById("etphonecodes-value_"+o).value="+"+i["calling-code"]+e.value.replace(/ /g,"").trim(),n},ETPhoneCodes.prototype.getDataCountryToCA2=function(e){for(var t=[],o=0;o<ETPhoneCodesData.countries.length;o++)ETPhoneCodesData.countries[o].ca2==e&&(t=ETPhoneCodesData.countries[o],o=ETPhoneCodesData.countries.length);return t},ETPhoneCodes.prototype.changePlaceholderFromCA2=function(e,t){var o=this.getDataCountryToCA2(t).placeholder;("undefined"==typeof o||""==o)&&(o=""),e.placeholder=o},ETPhoneCodes.prototype.wrapNode=function(e,t){var o=e.parentNode,n=e.previousSibling,a=e.nextSibling;t.appendChild(e),n==o?a==o?o.appendChild(t):o.insertBefore(t,a):this.insertAfter(t,n)},ETPhoneCodes.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},ETPhoneCodes.prototype.createCountryLi=function(e,t){var o="country";if(t="undefined"!=typeof t?t:!1,null==e)return!1;t&&(o+=" preferred");var n=document.createElement("li");n.className=o,n.setAttribute("data-country-code",e.ca2),n.setAttribute("data-dial-code",e["calling-code"]);var a=document.createElement("div");a.className="flag "+e.ca2,n.appendChild(a);var r=document.createElement("span");return r.className="country-name",r.innerHTML=e.name,n.appendChild(r),r=document.createElement("span"),r.className="dial-code",r.innerHTML="+"+e["calling-code"],n.appendChild(r),n},ETPhoneCodes.prototype.getEventTarget=function(e){return e=e||window.event,e.target||e.srcElement},ETPhoneCodes.prototype.showOrHideCountriesList=function(e,t){if(""==t)for(var o=document.getElementsByClassName("etphonecodes-countries-list"),n=0;n<o.length;n++)o[n].style.display="none";else{var a=this.getEventTarget(e),r=document.getElementById("etphonecodes-countries-list_"+t);"down-arrow"!=a.className&&a.parentNode.getAttribute("id")!="etphonecodes-selected-flag_"+t&&a.parentNode.getAttribute("id")!="etphonecodes-flag-dropdown_"+t&&"etphonecodes-search-zone"!=a.className&&a.getAttribute("id")!="etphonecodes-suppr-search-zone_"+t?r.style.display="none":"block"==r.style.display&&"etphonecodes-search-zone"!=a.className&&a.getAttribute("id")!="etphonecodes-suppr-search-zone_"+t?r.style.display="none":r.style.display="block"}},ETPhoneCodes.prototype.manageClickCountry=function(e,t,o,n,a){var r=ETPhoneCodes.prototype.getDataCountryToCA2(o)["calling-code"],d=document.getElementById("etphonecodes-container_"+a),s=d.getElementsByClassName("country active")[0];"undefined"!=typeof s&&(r=s.getAttribute("data-dial-code"),s.className=s.className.replace(/active/g,"").trim()),t.className+=" active",n.innerHTML="+"+t.getAttribute("data-dial-code"),ETPhoneCodes.prototype.changePlaceholderFromCA2(e,t.getAttribute("data-country-code")),document.getElementById("etphonecodes-selected-flag_"+a).getElementsByClassName("flag")[0].className="flag "+t.getAttribute("data-country-code"),document.getElementById("etphonecodes-calling-code_"+a).value="+"+t.getAttribute("data-dial-code"),document.getElementById("etphonecodes-value_"+a).value="+"+t.getAttribute("data-dial-code")+e.value.replace(/ /g,"").trim(),e.focus()};