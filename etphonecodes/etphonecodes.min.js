/*
ETPhoneCodes
version: 0.1.0
description: A javascript object for entering international telephone numbers
repository: https://github.com/EditionsTissot/ETPhoneCodes
license: GNU GENERAL PUBLIC LICENSE Version 2
author: Editions Tissot (http://www.editions-tissot.fr/)
*/

var ETPhoneCodes=function(a,b,c,d,e,f){if(this.IDNode="",this.startCountryCodeDefault="fr",this.preferredCountriesDefault=["fr","ch","be","mc","gf","gp","mq","re"],this.disablePlaceholderDefault=!1,this.placeholderDefault="e.g. +1 702 123 4567",this.countrySelectorOnlyDefault=!1,b="undefined"!=typeof b?b:this.startCountryCodeDefault,c="undefined"!=typeof c?c:this.preferredCountriesDefault,d="undefined"!=typeof d?d:this.placeholderDefault,e="undefined"!=typeof e?e:this.disablePlaceholderDefault,f="undefined"!=typeof f?f:this.countrySelectorOnlyDefault,"undefined"==typeof a||""==a)return this.log('ETPhoneCodes - FATAL ERROR: Thank you to specify the "IDNode" (The name of attribute id from your <input>).',"error");this.IDNode=a;var g=document.getElementById(this.IDNode);if(null==g)return this.log('ETPhoneCodes - FATAL ERROR: The node of "IDNode" does not exist, thank you to specify a id of an existing <input>.',"error");"tel"!=g.getAttribute("type")&&"text"!=g.getAttribute("type")&&this.log('ETPhoneCodes - WARNING: The type of your <input> must be "tel" or "text".',"warning");for(var h=document.getElementsByClassName("ETPhoneCodes-hide"),i=0;i<h.length;i++)h[i].style.display="none";var j=document.createElement("div");j.className="etphonecodes-container",j.setAttribute("id","etphonecodes-container_"+this.IDNode),j.setAttribute("data-id",this.IDNode),this.wrapNode(g,j);var k=document.createElement("div");k.setAttribute("id","etphonecodes-flag-dropdown_"+this.IDNode);var l=f?" etphonecodes-countryonly":"";k.className="f16 etphonecodes-flag-dropdown"+l;var m=document.createElement("div");m.setAttribute("id","etphonecodes-selected-flag_"+this.IDNode),m.className="etphonecodes-selected-flag";var n=document.createElement("div");n.className="flag "+b;var o=document.createElement("div");o.setAttribute("id","etphonecodes-callcode_"+this.IDNode),o.className="etphonecodes-callcode";var p=document.createElement("div");p.setAttribute("id","etphonecodes-txtlabel_"+this.IDNode),p.className="etphonecodes-txtlabel";var q=document.createElement("div");q.className="etphonecodes-down-arrow",f?(g.style.display="none",o.style.display="none"):p.style.display="none",m.appendChild(n),m.appendChild(o),m.appendChild(p),m.appendChild(q),k.appendChild(m),j.insertBefore(k,g);var r=document.createElement("ul");r.setAttribute("id","etphonecodes-countries-list_"+this.IDNode),r.className="hide etphonecodes-countries-list";var s=document.createElement("input");s.setAttribute("id","etphonecodes-search-zone_"+this.IDNode),s.placeholder="Nom du pays",s.className="etphonecodes-search-zone",r.appendChild(s);var t=document.createElement("div");t.setAttribute("id","etphonecodes-suppr-search-zone_"+this.IDNode),t.className="etphonecodes-suppr-search-zone",t.innerHTML="X",r.appendChild(t);for(var i=0;i<c.length;i++){var u=this.getDataCountryToCA2(c[i]),v=this.createCountryLi(u,!0,f);r.appendChild(v)}var w=document.createElement("li");w.className="divider",r.appendChild(w);for(var i=0;i<ETPhoneCodesData.countries.length;i++){var v=this.createCountryLi(ETPhoneCodesData.countries[i],!1,f);r.appendChild(v)}k.appendChild(r);var x=document.createElement("input");x.setAttribute("id","etphonecodes-calling-code_"+this.IDNode),x.setAttribute("type","hidden"),x.setAttribute("name",a+"_calling-code-value"),j.insertBefore(x,g);var y=document.createElement("input");y.setAttribute("id","etphonecodes-phone-number_"+this.IDNode),y.setAttribute("type","hidden"),y.setAttribute("name",a+"_phone-number-value"),j.insertBefore(y,g);var z=document.createElement("input");z.setAttribute("id","etphonecodes-value_"+this.IDNode),z.setAttribute("type","hidden"),z.setAttribute("name",g.getAttribute("name")),g.setAttribute("name",a+"_display-value"),j.insertBefore(z,g);var A=document.createElement("input");A.setAttribute("id","etphonecodes-isovalue_"+this.IDNode),A.setAttribute("type","hidden"),A.setAttribute("name","etphonecodes-isovalue_"+this.IDNode),j.insertBefore(A,g);var B=document.getElementById("etphonecodes-callcode_"+this.IDNode),C=document.getElementById("etphonecodes-txtlabel_"+this.IDNode),D="";x.value=this.getDataCountryToCA2(b)["calling-code"];var E="";if("00"==g.value.substr(0,2))for(var i=1;i<=5;i++)ETPhoneCodesData.countryCodes[g.value.substr(2,i)]&&(E=g.value.substr(2,i),i=99);""!=E?(g.value=g.value.substr(E.length+2,g.value.length-(E.length+2)),x.value=E,y.value="0"+g.value,b=ETPhoneCodesData.countryCodes[E][0],n.className="flag "+b,f&&(C.innerHTML=this.getDataCountryToCA2(b).name),ETPhoneCodes.prototype.InputFormating(g,b,a)):""!=b?(x.value=this.getDataCountryToCA2(b)["calling-code"],A.value=this.getDataCountryToCA2(b).ca2,f&&(C.innerHTML=this.getDataCountryToCA2(b).name)):C.innerHTML="&nbsp;",this.changePlaceholderFromCA2(g,b,e),B.innerHTML="+"+this.getDataCountryToCA2(b)["calling-code"],document.body.onclick=function(a){var b=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(a));ETPhoneCodes.prototype.showOrHideCountriesList(a,b)},r.onclick=function(a){var c=ETPhoneCodes.prototype.getEventTarget(a),d=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(a));"block"==r.style.display&&c.getAttribute("id")!="etphonecodes-countries-list_"+d&&"divider"!=c.className&&c.getAttribute("id")!="etphonecodes-suppr-search-zone_"+d&&"etphonecodes-search-zone"!=c.className&&(f?(txtDisplayer=C,countryCodeDisplayer=null):(txtDisplayer=null,countryCodeDisplayer=B),c.parentNode==r?ETPhoneCodes.prototype.manageClickCountry(g,c,b,countryCodeDisplayer,d,e,txtDisplayer):ETPhoneCodes.prototype.manageClickCountry(g,c.parentNode,b,countryCodeDisplayer,d,e,txtDisplayer),D=ETPhoneCodes.prototype.InputFormating(g,b,d)),a.stopPropagation()},g.onfocus=function(a){ETPhoneCodes.prototype.changePlaceholderFromCA2(g,b,!0)},g.onblur=function(a){var c=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(a)),d=document.getElementById("etphonecodes-container_"+c),f=d.getElementsByClassName("country active")[0];f="undefined"!=typeof f?f.getAttribute("data-country-code"):b,ETPhoneCodes.prototype.changePlaceholderFromCA2(g,f,e)},g.onkeypress=function(a){},g.onkeydown=function(a){var c=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(a)),e=(g.value,document.getElementById("etphonecodes-container_"+c)),f=e.getElementsByClassName("country active")[0];return f="undefined"!=typeof f?f.getAttribute("data-country-code"):b,!0},g.onkeyup=function(a){var c=ETPhoneCodes.prototype.getDataID(ETPhoneCodes.prototype.getEventTarget(a));D.trim()!=g.value.trim()&&(D=ETPhoneCodes.prototype.InputFormating(g,b,c))},t.onclick=function(a){F.value="",F.onkeyup()};var F=document.getElementById("etphonecodes-search-zone_"+this.IDNode);F.onkeyup=function(b){var c=document.getElementById("etphonecodes-container_"+a),d=F.value,e=c.getElementsByClassName("country");if(""!=d.trim())for(var f=0;f<e.length;f++)e[f].className=e[f].className.replace("hidden","").trim()+" hidden";else for(var f=0;f<e.length;f++)e[f].className=e[f].className.replace("hidden","").trim();var g=d.toUpperCase();g=new RegExp(g);for(var f=0;f<e.length;f++)g.test(e[f].getElementsByClassName("country-name")[0].innerHTML.toUpperCase())&&(new RegExp("preferred").test(e[f].className)||(e[f].className=e[f].className.replace("hidden","").trim()));return!0}};ETPhoneCodes.prototype.getDataID=function(a){return null!=a&&"BODY"!=a.tagName?null!=a.getAttribute("data-id")&&""!=a.getAttribute("data-id")?a.getAttribute("data-id"):ETPhoneCodes.prototype.getDataID(a.parentNode):""},ETPhoneCodes.prototype.log=function(a,b){switch(b=b||"black",bgc="White",b){case"success":b="Green",bgc="LimeGreen";break;case"info":b="DodgerBlue",bgc="Turquoise";break;case"error":b="Red",bgc="Black";break;case"start":b="OliveDrab",bgc="PaleGreen";break;case"warning":b="Tomato",bgc="Black";break;case"end":b="Orchid",bgc="MediumVioletRed";break;default:b=b}"object"==typeof a?console.log(a):"object"==typeof b?(console.log("%c"+a,"color: PowderBlue;font-weight:bold; background-color: RoyalBlue;"),console.log(b)):console.log("%c"+a,"color:"+b+";font-weight:bold; background-color: "+bgc+";")},ETPhoneCodes.prototype.InputFormating=function(a,b,c){var d=a.value,e=d,f=!1,g=document.getElementById("etphonecodes-container_"+c);d=d.replace(/\(0\)|^0/g,""),d=d.replace(/\(0/g,""),d=d.replace(/0\)/g,""),f=e!=d;var h="",i=g.getElementsByClassName("country active")[0];i="undefined"!=typeof i?i.getAttribute("data-country-code"):b;var j=ETPhoneCodes.prototype.getDataCountryToCA2(i);d=d.replace(/[^0-9]/g,"");var k=10;"undefined"!=typeof j.numbers&&(k=j.numbers),d.length>k&&(d=d.substr(0,k));var h=ETPhoneCodes.prototype.getDataCountryToCA2(b)["calling-code"];if(""!=h&&""!=i){var l={Z:/[1-9]/,C:/[0-9]/},m=d.replace(/ /g,"").trim(),j=ETPhoneCodes.prototype.getDataCountryToCA2(i),n="";if("undefined"!=typeof j.format&&""!=m)for(var o=0,p=0;p<m.length;p++)character=m.substr(p,1),o<j.format.length?(format=j.format.substr(o,1),"."==format&&(n+=" ",o++,format=j.format.substr(o,1)),l[format].test(character)?n+=""+character:"0"==character&&"Z"==format||(o=j.format.length,n+=""+character)):n+=""+character,o++;if("undefined"!=typeof j.format)n=""!=n?"(0)"+n:0==f||"(0)"==e||"(0"==e||"0)"==e?n:"(0)"+n,a.value=n,d=a.value;else{var q=a.value;q=q.replace(/[^0-9]/g,""),a.value=q}}return document.getElementById("etphonecodes-calling-code_"+c).value=j["calling-code"],document.getElementById("etphonecodes-phone-number_"+c).value=a.value.replace("(0)","0").replace(/ /g,"").trim(),document.getElementById("etphonecodes-value_"+c).value="00"+j["calling-code"]+a.value.replace("(0)","").replace(/ /g,"").trim(),document.getElementById("etphonecodes-isovalue_"+c).value=j.ca2,d},ETPhoneCodes.prototype.getDataCountryToCA2=function(a){for(var b=[],c=0;c<ETPhoneCodesData.countries.length;c++)ETPhoneCodesData.countries[c].ca2==a&&(b=ETPhoneCodesData.countries[c],c=ETPhoneCodesData.countries.length);return b},ETPhoneCodes.prototype.changePlaceholderFromCA2=function(a,b,c){var d=this.getDataCountryToCA2(b).placeholder;("undefined"==typeof d||""==d||c)&&(d=""),a.placeholder=d},ETPhoneCodes.prototype.wrapNode=function(a,b){var c=a.parentNode,d=a.previousSibling,e=a.nextSibling;b.appendChild(a),d==c?e==c?c.appendChild(b):c.insertBefore(b,e):this.insertAfter(b,d)},ETPhoneCodes.prototype.insertAfter=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)},ETPhoneCodes.prototype.createCountryLi=function(a,b,c){var d="country";if(b="undefined"!=typeof b&&b,c="undefined"!=typeof c&&c,null==a)return!1;b&&(d+=" preferred");var e=document.createElement("li");e.className=d,e.setAttribute("data-country-code",a.ca2),e.setAttribute("data-dial-code",a["calling-code"]),e.setAttribute("data-name",a.name);var f=document.createElement("div");f.className="flag "+a.ca2,e.appendChild(f);var g=document.createElement("span");return g.className="country-name",g.innerHTML=a.name,e.appendChild(g),c||(g=document.createElement("span"),g.className="dial-code",g.innerHTML="+"+a["calling-code"],e.appendChild(g)),e},ETPhoneCodes.prototype.getEventTarget=function(a){return a=a||window.event,a.target||a.srcElement},ETPhoneCodes.prototype.showOrHideCountriesList=function(a,b){if(""==b)for(var c=document.getElementsByClassName("etphonecodes-countries-list"),d=0;d<c.length;d++)c[d].style.display="none";else{var e=this.getEventTarget(a),f=document.getElementById("etphonecodes-countries-list_"+b);if("down-arrow"!=e.className&&e.parentNode.getAttribute("id")!="etphonecodes-selected-flag_"+b&&e.parentNode.getAttribute("id")!="etphonecodes-flag-dropdown_"+b&&"etphonecodes-search-zone"!=e.className&&e.getAttribute("id")!="etphonecodes-suppr-search-zone_"+b)f.style.display="none";else if("block"==f.style.display&&"etphonecodes-search-zone"!=e.className&&e.getAttribute("id")!="etphonecodes-suppr-search-zone_"+b)f.style.display="none";else{for(var c=document.getElementsByClassName("etphonecodes-countries-list"),d=0;d<c.length;d++)c[d].style.display="none";f.style.display="block"}}},ETPhoneCodes.prototype.manageClickCountry=function(a,b,c,d,e,f,g){var h=ETPhoneCodes.prototype.getDataCountryToCA2(c)["calling-code"],i=document.getElementById("etphonecodes-container_"+e),j=i.getElementsByClassName("country active")[0];"undefined"!=typeof j&&(h=j.getAttribute("data-dial-code"),j.className=j.className.replace(/active/g,"").trim()),b.className+=" active",null!=d&&(d.innerHTML="+"+b.getAttribute("data-dial-code")),ETPhoneCodes.prototype.changePlaceholderFromCA2(a,b.getAttribute("data-country-code"),f),document.getElementById("etphonecodes-selected-flag_"+e).getElementsByClassName("flag")[0].className="flag "+b.getAttribute("data-country-code"),document.getElementById("etphonecodes-calling-code_"+e).value="+"+b.getAttribute("data-dial-code"),document.getElementById("etphonecodes-value_"+e).value="+"+b.getAttribute("data-dial-code")+a.value.replace(/ /g,"").trim(),document.getElementById("etphonecodes-isovalue_"+e).value=b.getAttribute("data-country-code"),null!=g&&(g.innerHTML=b.getAttribute("data-name")),a.focus(),ETPhoneCodes.prototype.showOrHideCountriesList(null,e)};